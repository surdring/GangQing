# Phase 1-4（L1-L4）范围与里程碑边界（单一事实源）
本文件固化 GangQing（钢擎）Phase 1-4 与 L1-L4 的映射关系、试点边界与验收指标模板口径，作为后续任务分解与验收的范围基线。

## 1. 映射关系（来自 PRD Roadmap）
- **Phase 1：全知查询员（L1 / MVP）**
  - 目标：替代晨会繁琐报表，提供“一句话查数据”。
  - 强制：证据链（数据源+时间范围）；审计覆盖；只读默认。
- **Phase 2：维修副驾驶（L2）**
  - 目标：缩短 MTTR；多模态诊断辅助；建议必须可追溯。
- **Phase 3：生产决策辅助（L3）**
  - 目标：提升良品率/降低能耗；建议必须具备约束清单与证据链；默认不执行。
- **Phase 4：受控闭环（L4）**
  - 目标：在责任可界定前提下实现闭环提效；支持有限域写操作（含 IT 与 OT 写入）。
  - 前置条件：权限体系、审计、沙箱/演练、安全网关、Kill Switch、回滚能力。

## 2. 全局强制约束（所有 Phase 通用）
- **Read-Only Default**：默认只读；写操作必须“草案→审批/多签→受控执行→回滚点→审计”。
- **Evidence Required**：数值结论必须映射到数据源与时间范围；禁止伪造 citation/evidence id；不可校验必须降级。
- **RBAC & Masking**：所有接口/工具调用必须权限检查；敏感数据必须按角色脱敏，并记录审计。
- **Kill Switch**：写操作必须可熔断；熔断状态可审计、可观测；熔断时强制降级为仅查询。
- **Contract & Schema**：前端 Zod、后端 Pydantic；对外输出（含 streaming/events/evidence）输出前必须通过 schema 断言/序列化校验。
- **Error Handling**：错误 `message` 必须英文；对外错误模型包含 `code/message/details?/retryable/requestId`。
- **Observability**：`requestId` 必须贯穿 HTTP→编排→工具→日志/审计→对外响应。
- **Isolation**：`tenantId/projectId` 从 L1 起强制启用（默认过滤，跨隔离拦截并审计）。
- **Streaming**：对话输出需同时支持 SSE 与 WebSocket（验收必须覆盖两条端到端链路）。
- **Audit Storage**：审计先落 PostgreSQL，后写 Elasticsearch（ES）用于检索增强。

## 3. 试点边界（需要固化为白名单）

### 3.1 试点人群（按 Phase 扩展）
- Phase 1：P1 厂长/高管、P2 调度、P4 财务（以只读查询为主）。
- Phase 2：增加 P3 维修工（多模态输入与维修域知识）。
- Phase 3：生产/工艺相关角色（建议与约束校验）。
- Phase 4：受控闭环参与者（审批/多签/执行），角色权限必须独立配置。

### 3.2 试点系统范围（先契约后实现）
- 只读域：ERP/MES/DCS/EAM/LIMS 的查询接口清单与字段字典。
- 写入域（Phase 4）：
  - **IT 写入**：如工单生成、备件领料草案、排产草案下发（业务系统）。
  - **OT 写入**：DCS/PLC 类写入必须专用通道 + OT 二次确认，禁止直连反控。

### 3.3 试点产线/设备范围
- 以“产线/设备白名单 + 统一 ID（后续语义层落地）”表达。
- 与权限策略绑定：写权限与读权限分离，且写权限必须额外收敛到白名单范围。

## 4. 验收指标模板（口径框架）

### 4.1 业务价值类（示例模板）
- 指标：吨钢成本/吨钢能耗/批次毛利/订单准交率/库存周转/MTTR/良品率等。
- 验收口径：
  - 指标口径版本（`lineage_version`）
  - 数据源清单与时间范围
  - 计算公式或引用来源（若涉及）

### 4.2 质量与安全类（强制）
- 证据链完整性（可追溯比例）
- 审计覆盖率（query/tool_call/approval/write_operation）
- 越权拦截有效性（AUTH_ERROR 及审计）
- 脱敏覆盖率与可复核性
- Kill Switch 演练通过率

### 4.3 可用性与性能类
- P95 响应时间口径（按查询/分析/工具调用区分）
- 可用性目标与降级策略（外部系统不可用时明确提示）

### 4.4 可运维性类
- 日志字段齐全（包含 requestId、tenantId/projectId、sessionId、toolName 等可用字段）
- 审计可检索、可导出、可复核
