# 数据脱敏策略（Data Masking Policy）

本文件固化 GangQing（钢擎）在不同角色、不同数据域下的脱敏策略与验收口径。该策略与 `docs/security/rbac-matrix.md` 一起构成“可用但安全”的最小闭环。

## 0. 强制原则
- **先脱敏后放行**：能脱敏满足业务即放行；无法脱敏则拒绝。
- **高敏默认拒绝**：配方/工艺关键参数/财务原始单据等高敏字段默认拒绝，除非明确角色与策略允许。
- **审计强制**：发生脱敏、拒绝、跨隔离访问尝试必须写审计。

## 1. 敏感数据分类
- **S0（公开/低敏）**：设备名称、公开标准
- **S1（内部）**：一般生产指标、非关键运行参数
- **S2（敏感）**：成本汇总、产量/能耗关键指标、维修记录
- **S3（高敏）**：成本明细/利润、配方、关键工艺参数上限/下限、OT 写入目标

## 2. 脱敏级别
- `none`：不脱敏
- `partial`：部分脱敏（区间化、取整、阈值化、比例化、打码）
- `strict`：严格脱敏（只给趋势/变化率/相对值）
- `deny`：拒绝访问

## 3. 规则示例（验收基线）
### 3.1 财务域
- `manager`：`partial`（展示区间/同比环比，不展示原始明细）
- `finance`/`admin`：`none`（允许明细但仍禁止导出密钥/账号等）
- 其他角色：`deny`

### 3.2 生产/工艺域
- `scheduler`/`maintenance`：`partial`（展示范围/阈值，隐藏配方/关键设定值）
- `manager`：`strict` 或 `partial`（按策略）
- `admin`：`none`（受审计约束）

### 3.3 OT 写入相关
- 任何角色在未通过审批/白名单/Kill Switch 关闭之前：`deny`（只可生成草案）

## 4. 输出侧约束
- API 响应输出前必须根据角色策略进行脱敏。
- Evidence 中包含的 `details/data_points` 也必须执行同等脱敏策略。

## 5. 最小验收用例
- 同一成本查询在 `finance` 与 `scheduler` 下：分别验证不脱敏/拒绝或严格脱敏。
- 工艺参数查询在 `maintenance` 下：只能看到区间或阈值化结果。
- 每次脱敏动作：必须产生审计记录（含 `masking_level` 与字段摘要）。
